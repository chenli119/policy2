# CORS 代理服务使用指南

## 项目概述

这是一个基于 NestJS 的 CORS 代理服务，专门用于解决前端跨域问题。通过简单的 URL 参数，您可以轻松访问任何第三方 API，无需担心 CORS 限制。

## 🚀 快速开始

### 基本使用方法

```
https://your-domain.vercel.app/api/proxy?url=目标URL
```

### 实际示例

#### 原本跨域的请求（会失败）
```javascript
// ❌ 这会导致 CORS 错误
fetch('https://api.github.com/users/octocat')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('CORS Error:', error));
```

#### 使用代理服务（成功）
```javascript
// ✅ 通过代理服务访问，解决跨域问题
fetch('http://localhost:3000/api/proxy?url=https://api.github.com/users/octocat')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('Error:', error));
```

## 📋 支持的 HTTP 方法

### GET 请求
```javascript
// 获取用户信息
fetch('http://localhost:3000/api/proxy?url=https://jsonplaceholder.typicode.com/users/1')
```

### POST 请求
```javascript
// 创建新数据
fetch('http://localhost:3000/api/proxy?url=https://jsonplaceholder.typicode.com/posts', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    title: 'foo',
    body: 'bar',
    userId: 1
  })
})
```

### PUT 请求
```javascript
// 更新数据
fetch('http://localhost:3000/api/proxy?url=https://jsonplaceholder.typicode.com/posts/1', {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    id: 1,
    title: 'updated title',
    body: 'updated body',
    userId: 1
  })
})
```

### DELETE 请求
```javascript
// 删除数据
fetch('http://localhost:3000/api/proxy?url=https://jsonplaceholder.typicode.com/posts/1', {
  method: 'DELETE'
})
```

## 🔧 本地开发

### 1. 安装依赖
```bash
npm install
```

### 2. 启动开发服务器
```bash
npm run start:dev
```

### 3. 测试代理服务
访问: `http://localhost:3000/api/proxy?url=https://api.github.com/users/octocat`

## 🚀 部署到 Vercel

### 方法一：使用 Vercel CLI

1. **安装 Vercel CLI**
```bash
npm i -g vercel
```

2. **构建项目**
```bash
npm run build
```

3. **部署**
```bash
vercel
```

4. **按照提示完成部署**
   - 选择项目名称
   - 确认设置
   - 等待部署完成

### 方法二：GitHub 集成部署

1. **推送代码到 GitHub**
```bash
git add .
git commit -m "Initial commit"
git push origin main
```

2. **在 Vercel 中导入项目**
   - 访问 [Vercel Dashboard](https://vercel.com/dashboard)
   - 点击 "New Project"
   - 选择你的 GitHub 仓库
   - 点击 "Deploy"

3. **配置环境变量（如需要）**
   - 在 Vercel 项目设置中添加环境变量
   - 重新部署项目

## 🛡️ 安全特性

### URL 验证
- 只允许 `http://` 和 `https://` 协议
- 验证 URL 格式的有效性
- 防止恶意 URL 注入

### 请求头过滤
- 只转发安全的请求头
- 自动添加 User-Agent
- 移除敏感的内部头部

### 错误处理
- 完善的错误信息返回
- 超时保护（30秒）
- 重定向限制（最多5次）

## 🔍 故障排除

### 常见问题

#### 1. "缺少url参数" 错误
**原因**: 没有提供 `url` 查询参数
**解决**: 确保 URL 格式为 `?url=目标URL`

#### 2. "URL格式无效" 错误
**原因**: 提供的 URL 格式不正确
**解决**: 确保 URL 包含协议（http:// 或 https://）

#### 3. 请求超时
**原因**: 目标服务器响应时间过长
**解决**: 检查目标 URL 是否可访问，或稍后重试

### 调试技巧

1. **检查控制台日志**
```bash
npm run start:dev
# 查看详细的请求日志
```

2. **测试简单的 API**
```javascript
// 使用公开的测试 API
fetch('http://localhost:3000/api/proxy?url=https://httpbin.org/get')
```

3. **检查网络请求**
   - 打开浏览器开发者工具
   - 查看 Network 标签页
   - 检查请求和响应详情

## 📝 API 文档

### 端点
```
GET    /api/proxy?url={targetUrl}
POST   /api/proxy?url={targetUrl}
PUT    /api/proxy?url={targetUrl}
DELETE /api/proxy?url={targetUrl}
PATCH  /api/proxy?url={targetUrl}
OPTIONS /api/proxy
```

### 参数
- `url` (必需): 目标 API 的完整 URL

### 响应
- 成功: 返回目标 API 的原始响应
- 失败: 返回错误信息和状态码

### 示例响应
```json
{
  "error": "缺少url参数",
  "usage": "请使用 ?url=目标URL 的格式"
}
```

## 🎯 使用场景

1. **前端开发**: 在开发环境中访问第三方 API
2. **原型制作**: 快速集成外部数据源
3. **API 测试**: 测试不同的 API 端点
4. **数据聚合**: 从多个源收集数据

## 📞 技术支持

如果您遇到问题或需要帮助，请：
1. 检查本文档的故障排除部分
2. 查看项目的 GitHub Issues
3. 提交新的 Issue 描述您的问题

---

**注意**: 请确保遵守目标 API 的使用条款和速率限制。这个代理服务仅用于解决 CORS 问题，不应用于绕过 API 的安全限制。